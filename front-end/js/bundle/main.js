!function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=14)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.loadInfoForLatLon=function(t){var e;e="pop"==t?o+"/popular.json":i+"/"+t.replace(",","")+".json";return $.getJSON(e).then(function(e){$.extend(r,e);var n=[];for(var o in e)n.push(o);return"pop"!=t&&(l[t]=function(t){for(var e in t){var n=t[e];if(n.original_title)return n.original_title}}(e)),n})},e.infoForPhotoId=a,e.descriptionForPhotoId=function(t){var e=a(t),n=e.title;n&&(n+=" ");var r=e.date.replace(/n\.d\.?/,"No Date");r||(r="No Date");return n+=r},e.libraryUrlForPhotoId=function(t){return"http://digitalcollections.nypl.org/items/image_id/"+t.replace(/-[a-z]$/,"")},e.backId=u,e.backOfCardUrlForPhotoId=function(t){return"http://images.nypl.org/?id="+u(t)+"&t=w"},e.nameForLatLon=function(t){return(l[t]||"").replace(/: | - | & /g,"\n")};var r={},o="",i=o+"/by-location";function a(t){return r[t]||{title:"",date:"",library_url:""}}function u(t){return t.replace("f","b").replace(/-[a-z]$/,"")}var l={}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.mapPromise=e.map=e.lat_lon_to_marker=void 0;var r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{!r&&u.return&&u.return()}finally{if(o)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();e.countPhotos=k,e.selectMarker=_,e.updateYears=S,e.initialize_map=function(){var t={zoom:15,maxZoom:18,minZoom:10,center:new google.maps.LatLng(-31.953512,115.857048),mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,streetViewControl:!0,panControl:!1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},styles:i.MAP_STYLE};e.map=m=new google.maps.Map($("#map").get(0),t);var n=$("<div/>").append($("<div/>").addClass("spacer")).get(0);n.index=-1,m.controls[google.maps.ControlPosition.TOP_LEFT].push(n);var r=m.getStreetView();google.maps.event.addListener(r,"visible_changed",function(){$(".streetview-hide").toggle(!r.getVisible())}),h.push(null),v.push(null);for(var o=0;o<100;o++){var a=o+1,u=1==a?9:13,l=1==a?15:21;h.push(new google.maps.MarkerImage("images/sprite-2014-08-29.png",new google.maps.Size(u,u),new google.maps.Point(o%10*39,39*Math.floor(o/10)),new google.maps.Point((u-1)/2,(u-1)/2))),v.push(new google.maps.MarkerImage("images/selected-2014-08-29.png",new google.maps.Size(l,l),new google.maps.Point(o%10*39,39*Math.floor(o/10)),new google.maps.Point((l-1)/2,(l-1)/2)))}var c=google.maps.event.addListener(m,"idle",function(){google.maps.event.removeListener(c),j(),b.resolve(m)});google.maps.event.addListener(m,"bounds_changed",function(){j()})},e.parseLatLon=I,e.createMarker=O,e.showExpanded=A,e.hideExpanded=F,e.getPopularPhotoIds=function(){return $(".popular-photo:visible a").map(function(t,e){return M(e)}).toArray()},e.fillPopularImagesPanel=function(){var t=(new Date).getTime()-new Date("2015/12/15").getTime(),e=Math.floor(t/86400/1e3)%l.popular_photos.length,n=l.popular_photos.slice(e).concat(l.popular_photos.slice(0,e)),r=$.map(n,function(t){var e=$("#popular-photo-template").clone().removeAttr("id");e.find("a").attr("href","#"+t.id),e.find("img").attr("border","0").attr("data-src",(n=t.id,"http://oldnyc-assets.nypl.org/600px/"+n+".jpg")).attr("height",t.height),e.find(".desc").text(t.desc),e.find(".loc").text(t.loc),t.date&&e.find(".date").text(" ("+t.date+")");var n;return e.get(0)});$("#popular").append($(r).show()),$(r).appear({force_process:!0}),$("#popular").on("appear",".popular-photo",function(){var t=$(this).find("img[data-src]");!function(t){if($(t).attr("src"))return;$(t).attr("src",$(t).attr("data-src")).removeAttr("data-src")}(t.get(0))})},e.showAbout=C,e.hideAbout=B;var o=n(0),i=n(9),a=n(8),u=n(3),l=n(7),c=n(2),s=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(n(6));var f,p,d=[],h=[],g=e.lat_lon_to_marker={},v=[],y=[1800,2e3],m=e.map=void 0,b=e.mapPromise=$.Deferred();function w(t){return"http://maps.googleapis.com/maps/api/staticmap?center="+t+"&zoom=15&size=150x150&maptype=roadmap&markers=color:red%7C"+t+"&style="+i.STATIC_MAP_STYLE}function x(t){return 1800===t[0]&&2e3===t[1]}function k(t){if(x(y))return s.reduce(t,function(t,e){return t+e});var e=r(y,2),n=e[0],o=e[1];return s.reduce(s.filter(t,function(t,e){return e>n&&e<=o}),function(t,e){return t+e})}function _(t,e){var n=k(e),r=0;f&&(r=f.getZIndex(),f.setIcon(p)),t&&(f=t,p=t.getIcon(),t.setIcon(v[n>100?100:n]),t.setZIndex(1e5+r))}function S(t,e){y=[t,e],s.forEach(g,function(t,e){var n=k(lat_lons[e]);n?(t.setIcon(h[Math.min(n,100)]),t.setVisible(!0)):t.setVisible(!1)}),j(),$("#time-range-labels").text(t+"–"+e)}function P(t,e,n){e&&_(e,lat_lons[t]),(0,o.loadInfoForLatLon)(t).done(function(e){var r=null;e.length<=10&&(r=e[0]),A(t,e,r),n&&r&&n(r)}).fail(function(){})}function T(t){var e=t.latLng.lat().toFixed(6)+","+t.latLng.lng().toFixed(6);P(e,g[e],function(t){$(window).trigger("openPreviewPanel"),$(window).trigger("showPhotoPreview",t)}),$(window).trigger("showGrid",e)}function j(){var t=m.getBounds();for(var e in lat_lons)if(!(e in g)){var n=I(e);t.contains(n)&&O(e,n)}}function I(t){var e=t.split(",");return new google.maps.LatLng(parseFloat(e[0]),parseFloat(e[1]))}function O(t,e){var n=k(lat_lons[t]);if(n){var r=new google.maps.Marker({position:e,map:m,flat:!0,visible:!0,icon:h[Math.min(n,100)],title:t});return d.push(r),g[t]=r,google.maps.event.addListener(r,"click",T),r}}function A(t,e,n){if(B(),m.set("keyboardShortcuts",!1),$("#expanded").show().data("grid-key",t),$(".location").text((0,o.nameForLatLon)(t)),x(y))$("#filtered-slideshow").hide();else{var i=r(y,2),a=i[0],u=i[1];$("#filtered-slideshow").show(),$("#slideshow-filter-first").text(a),$("#slideshow-filter-last").text(u)}var l=$.map(e,function(t){var e=(0,o.infoForPhotoId)(t);return function(t,e){if(x(e))return!0;for(var n=r(e,2),o=n[0],i=n[1],a=0;a<t.years.length;a++){var u=t.years[a];if(u&&u>=o&&u<=i)return!0}return!1}(e,y)?$.extend({id:t,largesrc:e.image_url,src:e.thumb_url,width:600,height:400},e):null});l=l.filter(function(t){return null!==t}),$("#preview-map").attr("src",w(t)),$("#grid-container").expandableGrid({rowHeight:200,speed:200},l),n&&$("#grid-container").expandableGrid("select",n)}function F(){$("#expanded").hide(),$(document).unbind("keyup"),m.set("keyboardShortcuts",!0)}function M(t){return $(t).attr("href").replace("#","")}function L(){$("#popular").hide(),$(".popular-link").show()}function C(){F(),$("#about-page").show();var t=$("#about-page .container"),e=t.width();e<parseInt(t.css("max-width"),0)&&t.css("margin-left","-"+e/2+"px")}function B(){$("#about-page").hide()}$.fn.scrollGuard=function(){return this.on("mousewheel",function(){var t=this.scrollHeight,e=$(this).height();return!(this.scrollTop===t-e&&event.deltaY<0||0===this.scrollTop&&event.deltaY>0)})},$(function(){$(document).on("click","#expanded .curtains, #expanded .exit",function(){F(),$(window).trigger("hideGrid")}),$("#grid-container, #expanded .header").on("click",function(t){(t.target==this||$(t.target).is(".og-grid"))&&(F(),$(window).trigger("hideGrid"))}),$("#grid-container").on("og-fill","li",function(t,e){var n,r,i,l=$(this).data("image-id");$(e).empty().append($("#image-details-template").clone().removeAttr("id").show()),$(e).parent().find(".og-details-left").empty().append($("#image-details-left-template").clone().removeAttr("id").show()),function(t,e){$(".description",e).html((0,o.descriptionForPhotoId)(t));var n=(0,o.infoForPhotoId)(t),r=(0,o.libraryUrlForPhotoId)(t);e.parent().find(".nypl-link a").attr("href",r),$(".nypl-logo a").attr("href",r);var i=(0,a.getCanonicalUrlForPhoto)(t);if((0,u.getFeedbackText)((0,o.backId)(t)).done(function(o){var i=o?o.text:n.text,a="/ocr.html#"+t,u=t.match("[0-9]f");if(i){var l=e.find(".text");l.text(i.replace(/\n*$/,"")),l.append($("<i>&nbsp; &nbsp; Typos? Help <a target=_blank href>fix them</a>.</i>")),l.find("a").attr("href",a)}else if(u){var c=e.find(".more-on-back");c.find("a.ocr-tool").attr("href",a),c.find("a.nypl").attr("href",r),c.show()}}),"undefined"!=typeof FB){var l=e.find(".comments"),c=l.parent().width();l.empty().append($('<fb:comments data-numposts="5" data-colorscheme="light"/>').attr("data-width",c).attr("data-href",i).attr("data-version","v2.3")),FB.XFBML.parse(l.get(0)),console.log(i)}var s=new ZeroClipboard(e.find(".copy-link"));if(s.on("ready",function(){s.on("copy",function(t){t.clipboardData.setData("text/plain",window.location.href)}),s.on("aftercopy",function(t){var e=$(t.target);e.css({width:e.get(0).offsetWidth}).addClass("clicked").text("Copied!")})}),"undefined"!=typeof twttr&&twttr.widgets.createShareButton(document.location.href,e.find(".tweet").get(0),{count:"none",text:(n.original_title||n.title)+" - "+n.date,via:"Old_NYC @NYPL"}),"undefined"!=typeof FB){var f=e.find(".facebook-holder");f.empty().append($("<fb:like>").attr({href:i,layout:"button",action:"like",show_faces:"false",share:"true"})),FB.XFBML.parse(f.get(0))}e.off("mousewheel").on("mousewheel",function(t){var n=e.height(),r=e.get(0).scrollHeight;return!(this.scrollTop===r-n&&t.deltaY<0||0===this.scrollTop&&t.deltaY>0)})}(l,$(e)),"pop"==$("#expanded").data("grid-key")&&(n=l,r="New York City",(i=(0,c.findLatLonForPhoto)(n))&&(r=i),$("#preview-map").attr("src",w(r)))}).on("click",".og-fullimg > img",function(){var t=$("#grid-container").expandableGrid("selectedId");window.open((0,o.libraryUrlForPhotoId)(t),"_blank")}),$("#grid-container").on("click",".rotate-image-button",function(t){t.preventDefault();var e=$(this).closest("li").find(".og-fullimg > img"),n=e.data("rotate")||0;n+=90,e.css("transform","rotate("+n+"deg)").data("rotate",n);var r=$("#grid-container").expandableGrid("selectedId");ga("send","event","link","rotate",{page:"#"+r+"("+n+")"}),(0,u.sendFeedback)(r,"rotate",{rotate:n,original:(0,o.infoForPhotoId)(r).rotation||null})}).on("click",".feedback-button",function(t){t.preventDefault(),$("#grid-container .details").fadeOut(),$("#grid-container .feedback").fadeIn()}).on("click","a.back",function(t){t.preventDefault(),$("#grid-container .feedback").fadeOut(),$("#grid-container .details").fadeIn()}),$(document).on("keyup","input, textarea",function(t){t.stopPropagation()}),$(".popular-photo").on("click","a",function(t){t.preventDefault();var e=M(this);(0,o.loadInfoForLatLon)("pop").done(function(t){A("pop",t,e),$(window).trigger("showGrid","pop"),$(window).trigger("openPreviewPanel"),$(window).trigger("showPhotoPreview",e)}).fail(function(){})}),$("#popular").on("scroll",function(){$(this).appear({force_process:!0})}),$("#popular .close").on("click",function(){(0,u.setCookie)("nopop","1"),L()}),$(".popular-link a").on("click",function(t){$("#popular").show(),$(".popular-link").hide(),$("#popular").appear({force_process:!0}),(0,u.deleteCookie)("nopop"),t.preventDefault()}),document.cookie.indexOf("nopop=")>=0&&L(),$("#about a").on("click",function(t){t.preventDefault(),C()}),$("#about-page .curtains, #about-page .exit").on("click",B);$("#grid-container").on("click",".feedback button[feedback]",function(){var t=$(this),e=!0;if(t.attr("feedback-param")){var n=t.siblings("input, textarea");if(""==(e=n.val()))return;n.prop("disabled",!0)}t.prop("disabled",!0);var r,o=$("#grid-container").expandableGrid("selectedId"),i=t.attr("feedback"),a={};a[i]=e,(0,u.sendFeedback)(o,i,a).then((r=t.get(0),function(){$(r).text("Thanks!")}))}),$("#grid-container").on("og-select","li",function(){var t=$(this).data("image-id");$(window).trigger("showPhotoPreview",t)}).on("og-deselect",function(){$(window).trigger("closePreviewPanel")}).on("og-openpreview",function(){$(window).trigger("openPreviewPanel")}),$("#time-slider").slider({range:!0,min:1800,max:2e3,values:y,slide:function(t,e){var n=r(e.values,2);S(n[0],n[1])},stop:function(t,e){var n=r(e.values,2),o=n[0],i=n[1];ga("send","event","link","time-slider",{page:"#"+o+"–"+i})}}),$("#time-range-summary").on("click",function(){$("#time-range").toggle()}),$("#slideshow-all").on("click",function(){S(1800,2e3),$("#time-slider").slider({values:y});var t=$("#expanded").data("grid-key");ga("send","event","link","time-slider-clear"),F(),P(t)})})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getCurrentStateObject=i,e.hashToStateObject=a,e.stateObjectToHash=u,e.transitionToStateObject=function(t){var e=i();a(u(t),function(t){if(JSON.stringify(e)!=JSON.stringify(t))if("{}"==JSON.stringify(t)&&((0,r.hideAbout)(),(0,r.hideExpanded)()),e.g==t.g)e.photo_id&&!t.photo_id?$("#grid-container").expandableGrid("deselect"):$("#grid-container").expandableGrid("select",t.photo_id);else{var n=t.g,i=(0,r.countPhotos)(lat_lons[n]);if("pop"==t.g)i=(0,r.getPopularPhotoIds)().length;else{var a=r.lat_lon_to_marker[n],u=(0,r.parseLatLon)(n);a||(a=(0,r.createMarker)(n,u)),a&&((0,r.selectMarker)(a,i),r.map.getBounds().contains(u)||r.map.panTo(u))}(0,o.loadInfoForLatLon)(n).done(function(e){(0,r.showExpanded)(t.g,e,t.photo_id)})}})},e.findLatLonForPhoto=l;var r=n(1),o=n(0);function i(){if(!$("#expanded").is(":visible"))return{};var t=$("#expanded").data("grid-key"),e=$("#grid-container").expandableGrid("selectedId");return e?{photo_id:e,g:t}:{g:t}}function a(t,e){var n=t.match(/(.*),g:(.*)/);if(n)e({photo_id:n[1],g:n[2]});else if("g:"==t.substr(0,2))e({g:t.substr(2)});else if(t.length>0){l(t,function(n){e({photo_id:t,g:n})})}else e({})}function u(t){return t.photo_id?"pop"==t.g?t.photo_id+",g:pop":t.photo_id:t.g?"g:"+t.g:""}function l(t,e){var n=t.slice(0,4);$.ajax({dataType:"json",url:"/id4-to-location/"+n+".json",success:function(n){e(n[t])}})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.deleteCookie=function(t){document.cookie=t+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT;"},e.setCookie=a,e.getCookie=u,e.sendFeedback=function(t,e,n){ga("send","event","link","feedback",{page:"#"+t}),n.metadata={timestamp:Firebase.ServerValue.TIMESTAMP,user_agent:navigator.userAgent,user_ip:o?o.ip:"",location:o?o.location:"",cookie:l};var i="/feedback/"+t+"/"+e,a=r.child(i),u=$.Deferred();return a.push(n,function(t){t?(console.error("Error pushing",t),u.reject(t)):u.resolve()}),u},e.getFeedbackText=function(t){var e=$.Deferred();return i.then(function(n){r.child("/feedback/"+t+"/text").orderByKey().once("value",function(t){var r=null;t.forEach(function(t){var e=t.val();e.metadata.timestamp>n&&(r=e)}),e.resolve(r)})}),e};var r=null;"undefined"!=typeof Firebase&&(r=new Firebase("https://brilliant-heat-1088.firebaseio.com/"));var o=null;$.get("//ipinfo.io",function(t){o={ip:t.ip,location:t.country+"-"+t.region+"-"+t.city}},"jsonp");var i=$.get("/timestamps.json").then(function(t){return t.ocr_ms});function a(t,e){document.cookie=t+"="+e+"; path=/"}function u(t){var e;return(e=document.cookie.match("(^|;)\\s*"+t+"\\s*=\\s*([^;]+)"))?e.pop():""}var l=u("oldnycid");l||a("oldnycid",l="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))},function(t,e){t.exports=function(t){return t.webpackPolyfill||(t.deprecate=function(){},t.paths=[],t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),t.webpackPolyfill=1),t}},function(t,e){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){(function(t,n){var r;!function(){var o="object"==typeof self&&self.self===self&&self||"object"==typeof t&&t.global===t&&t||this||{},i=o._,a=Array.prototype,u=Object.prototype,l="undefined"!=typeof Symbol?Symbol.prototype:null,c=a.push,s=a.slice,f=u.toString,p=u.hasOwnProperty,d=Array.isArray,h=Object.keys,g=Object.create,v=function(){},y=function(t){return t instanceof y?t:this instanceof y?void(this._wrapped=t):new y(t)};void 0===e||e.nodeType?o._=y:(void 0!==n&&!n.nodeType&&n.exports&&(e=n.exports=y),e._=y),y.VERSION="1.9.0";var m,b=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 3:return function(n,r,o){return t.call(e,n,r,o)};case 4:return function(n,r,o,i){return t.call(e,n,r,o,i)}}return function(){return t.apply(e,arguments)}},w=function(t,e,n){return y.iteratee!==m?y.iteratee(t,e):null==t?y.identity:y.isFunction(t)?b(t,e,n):y.isObject(t)&&!y.isArray(t)?y.matcher(t):y.property(t)};y.iteratee=m=function(t,e){return w(t,e,1/0)};var x=function(t,e){return e=null==e?t.length-1:+e,function(){for(var n=Math.max(arguments.length-e,0),r=Array(n),o=0;o<n;o++)r[o]=arguments[o+e];switch(e){case 0:return t.call(this,r);case 1:return t.call(this,arguments[0],r);case 2:return t.call(this,arguments[0],arguments[1],r)}var i=Array(e+1);for(o=0;o<e;o++)i[o]=arguments[o];return i[e]=r,t.apply(this,i)}},k=function(t){if(!y.isObject(t))return{};if(g)return g(t);v.prototype=t;var e=new v;return v.prototype=null,e},$=function(t){return function(e){return null==e?void 0:e[t]}},_=function(t,e){for(var n=e.length,r=0;r<n;r++){if(null==t)return;t=t[e[r]]}return n?t:void 0},S=Math.pow(2,53)-1,P=$("length"),T=function(t){var e=P(t);return"number"==typeof e&&e>=0&&e<=S};y.each=y.forEach=function(t,e,n){var r,o;if(e=b(e,n),T(t))for(r=0,o=t.length;r<o;r++)e(t[r],r,t);else{var i=y.keys(t);for(r=0,o=i.length;r<o;r++)e(t[i[r]],i[r],t)}return t},y.map=y.collect=function(t,e,n){e=w(e,n);for(var r=!T(t)&&y.keys(t),o=(r||t).length,i=Array(o),a=0;a<o;a++){var u=r?r[a]:a;i[a]=e(t[u],u,t)}return i};var j=function(t){return function(e,n,r,o){var i=arguments.length>=3;return function(e,n,r,o){var i=!T(e)&&y.keys(e),a=(i||e).length,u=t>0?0:a-1;for(o||(r=e[i?i[u]:u],u+=t);u>=0&&u<a;u+=t){var l=i?i[u]:u;r=n(r,e[l],l,e)}return r}(e,b(n,o,4),r,i)}};y.reduce=y.foldl=y.inject=j(1),y.reduceRight=y.foldr=j(-1),y.find=y.detect=function(t,e,n){var r=(T(t)?y.findIndex:y.findKey)(t,e,n);if(void 0!==r&&-1!==r)return t[r]},y.filter=y.select=function(t,e,n){var r=[];return e=w(e,n),y.each(t,function(t,n,o){e(t,n,o)&&r.push(t)}),r},y.reject=function(t,e,n){return y.filter(t,y.negate(w(e)),n)},y.every=y.all=function(t,e,n){e=w(e,n);for(var r=!T(t)&&y.keys(t),o=(r||t).length,i=0;i<o;i++){var a=r?r[i]:i;if(!e(t[a],a,t))return!1}return!0},y.some=y.any=function(t,e,n){e=w(e,n);for(var r=!T(t)&&y.keys(t),o=(r||t).length,i=0;i<o;i++){var a=r?r[i]:i;if(e(t[a],a,t))return!0}return!1},y.contains=y.includes=y.include=function(t,e,n,r){return T(t)||(t=y.values(t)),("number"!=typeof n||r)&&(n=0),y.indexOf(t,e,n)>=0},y.invoke=x(function(t,e,n){var r,o;return y.isFunction(e)?o=e:y.isArray(e)&&(r=e.slice(0,-1),e=e[e.length-1]),y.map(t,function(t){var i=o;if(!i){if(r&&r.length&&(t=_(t,r)),null==t)return;i=t[e]}return null==i?i:i.apply(t,n)})}),y.pluck=function(t,e){return y.map(t,y.property(e))},y.where=function(t,e){return y.filter(t,y.matcher(e))},y.findWhere=function(t,e){return y.find(t,y.matcher(e))},y.max=function(t,e,n){var r,o,i=-1/0,a=-1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var u=0,l=(t=T(t)?t:y.values(t)).length;u<l;u++)null!=(r=t[u])&&r>i&&(i=r);else e=w(e,n),y.each(t,function(t,n,r){((o=e(t,n,r))>a||o===-1/0&&i===-1/0)&&(i=t,a=o)});return i},y.min=function(t,e,n){var r,o,i=1/0,a=1/0;if(null==e||"number"==typeof e&&"object"!=typeof t[0]&&null!=t)for(var u=0,l=(t=T(t)?t:y.values(t)).length;u<l;u++)null!=(r=t[u])&&r<i&&(i=r);else e=w(e,n),y.each(t,function(t,n,r){((o=e(t,n,r))<a||o===1/0&&i===1/0)&&(i=t,a=o)});return i},y.shuffle=function(t){return y.sample(t,1/0)},y.sample=function(t,e,n){if(null==e||n)return T(t)||(t=y.values(t)),t[y.random(t.length-1)];var r=T(t)?y.clone(t):y.values(t),o=P(r);e=Math.max(Math.min(e,o),0);for(var i=o-1,a=0;a<e;a++){var u=y.random(a,i),l=r[a];r[a]=r[u],r[u]=l}return r.slice(0,e)},y.sortBy=function(t,e,n){var r=0;return e=w(e,n),y.pluck(y.map(t,function(t,n,o){return{value:t,index:r++,criteria:e(t,n,o)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index}),"value")};var I=function(t,e){return function(n,r,o){var i=e?[[],[]]:{};return r=w(r,o),y.each(n,function(e,o){var a=r(e,o,n);t(i,e,a)}),i}};y.groupBy=I(function(t,e,n){y.has(t,n)?t[n].push(e):t[n]=[e]}),y.indexBy=I(function(t,e,n){t[n]=e}),y.countBy=I(function(t,e,n){y.has(t,n)?t[n]++:t[n]=1});var O=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;y.toArray=function(t){return t?y.isArray(t)?s.call(t):y.isString(t)?t.match(O):T(t)?y.map(t,y.identity):y.values(t):[]},y.size=function(t){return null==t?0:T(t)?t.length:y.keys(t).length},y.partition=I(function(t,e,n){t[n?0:1].push(e)},!0),y.first=y.head=y.take=function(t,e,n){if(!(null==t||t.length<1))return null==e||n?t[0]:y.initial(t,t.length-e)},y.initial=function(t,e,n){return s.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},y.last=function(t,e,n){if(!(null==t||t.length<1))return null==e||n?t[t.length-1]:y.rest(t,Math.max(0,t.length-e))},y.rest=y.tail=y.drop=function(t,e,n){return s.call(t,null==e||n?1:e)},y.compact=function(t){return y.filter(t,Boolean)};var A=function(t,e,n,r){for(var o=(r=r||[]).length,i=0,a=P(t);i<a;i++){var u=t[i];if(T(u)&&(y.isArray(u)||y.isArguments(u)))if(e)for(var l=0,c=u.length;l<c;)r[o++]=u[l++];else A(u,e,n,r),o=r.length;else n||(r[o++]=u)}return r};y.flatten=function(t,e){return A(t,e,!1)},y.without=x(function(t,e){return y.difference(t,e)}),y.uniq=y.unique=function(t,e,n,r){y.isBoolean(e)||(r=n,n=e,e=!1),null!=n&&(n=w(n,r));for(var o=[],i=[],a=0,u=P(t);a<u;a++){var l=t[a],c=n?n(l,a,t):l;e&&!n?(a&&i===c||o.push(l),i=c):n?y.contains(i,c)||(i.push(c),o.push(l)):y.contains(o,l)||o.push(l)}return o},y.union=x(function(t){return y.uniq(A(t,!0,!0))}),y.intersection=function(t){for(var e=[],n=arguments.length,r=0,o=P(t);r<o;r++){var i=t[r];if(!y.contains(e,i)){var a;for(a=1;a<n&&y.contains(arguments[a],i);a++);a===n&&e.push(i)}}return e},y.difference=x(function(t,e){return e=A(e,!0,!0),y.filter(t,function(t){return!y.contains(e,t)})}),y.unzip=function(t){for(var e=t&&y.max(t,P).length||0,n=Array(e),r=0;r<e;r++)n[r]=y.pluck(t,r);return n},y.zip=x(y.unzip),y.object=function(t,e){for(var n={},r=0,o=P(t);r<o;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n};var F=function(t){return function(e,n,r){n=w(n,r);for(var o=P(e),i=t>0?0:o-1;i>=0&&i<o;i+=t)if(n(e[i],i,e))return i;return-1}};y.findIndex=F(1),y.findLastIndex=F(-1),y.sortedIndex=function(t,e,n,r){for(var o=(n=w(n,r,1))(e),i=0,a=P(t);i<a;){var u=Math.floor((i+a)/2);n(t[u])<o?i=u+1:a=u}return i};var M=function(t,e,n){return function(r,o,i){var a=0,u=P(r);if("number"==typeof i)t>0?a=i>=0?i:Math.max(i+u,a):u=i>=0?Math.min(i+1,u):i+u+1;else if(n&&i&&u)return r[i=n(r,o)]===o?i:-1;if(o!=o)return(i=e(s.call(r,a,u),y.isNaN))>=0?i+a:-1;for(i=t>0?a:u-1;i>=0&&i<u;i+=t)if(r[i]===o)return i;return-1}};y.indexOf=M(1,y.findIndex,y.sortedIndex),y.lastIndexOf=M(-1,y.findLastIndex),y.range=function(t,e,n){null==e&&(e=t||0,t=0),n||(n=e<t?-1:1);for(var r=Math.max(Math.ceil((e-t)/n),0),o=Array(r),i=0;i<r;i++,t+=n)o[i]=t;return o},y.chunk=function(t,e){if(null==e||e<1)return[];for(var n=[],r=0,o=t.length;r<o;)n.push(s.call(t,r,r+=e));return n};var L=function(t,e,n,r,o){if(!(r instanceof e))return t.apply(n,o);var i=k(t.prototype),a=t.apply(i,o);return y.isObject(a)?a:i};y.bind=x(function(t,e,n){if(!y.isFunction(t))throw new TypeError("Bind must be called on a function");var r=x(function(o){return L(t,r,e,this,n.concat(o))});return r}),y.partial=x(function(t,e){var n=y.partial.placeholder,r=function(){for(var o=0,i=e.length,a=Array(i),u=0;u<i;u++)a[u]=e[u]===n?arguments[o++]:e[u];for(;o<arguments.length;)a.push(arguments[o++]);return L(t,r,this,this,a)};return r}),y.partial.placeholder=y,y.bindAll=x(function(t,e){var n=(e=A(e,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=e[n];t[r]=y.bind(t[r],t)}}),y.memoize=function(t,e){var n=function(r){var o=n.cache,i=""+(e?e.apply(this,arguments):r);return y.has(o,i)||(o[i]=t.apply(this,arguments)),o[i]};return n.cache={},n},y.delay=x(function(t,e,n){return setTimeout(function(){return t.apply(null,n)},e)}),y.defer=y.partial(y.delay,y,1),y.throttle=function(t,e,n){var r,o,i,a,u=0;n||(n={});var l=function(){u=!1===n.leading?0:y.now(),r=null,a=t.apply(o,i),r||(o=i=null)},c=function(){var c=y.now();u||!1!==n.leading||(u=c);var s=e-(c-u);return o=this,i=arguments,s<=0||s>e?(r&&(clearTimeout(r),r=null),u=c,a=t.apply(o,i),r||(o=i=null)):r||!1===n.trailing||(r=setTimeout(l,s)),a};return c.cancel=function(){clearTimeout(r),u=0,r=o=i=null},c},y.debounce=function(t,e,n){var r,o,i=function(e,n){r=null,n&&(o=t.apply(e,n))},a=x(function(a){if(r&&clearTimeout(r),n){var u=!r;r=setTimeout(i,e),u&&(o=t.apply(this,a))}else r=y.delay(i,e,this,a);return o});return a.cancel=function(){clearTimeout(r),r=null},a},y.wrap=function(t,e){return y.partial(e,t)},y.negate=function(t){return function(){return!t.apply(this,arguments)}},y.compose=function(){var t=arguments,e=t.length-1;return function(){for(var n=e,r=t[e].apply(this,arguments);n--;)r=t[n].call(this,r);return r}},y.after=function(t,e){return function(){if(--t<1)return e.apply(this,arguments)}},y.before=function(t,e){var n;return function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=null),n}},y.once=y.partial(y.before,2),y.restArguments=x;var C=!{toString:null}.propertyIsEnumerable("toString"),B=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],E=function(t,e){var n=B.length,r=t.constructor,o=y.isFunction(r)&&r.prototype||u,i="constructor";for(y.has(t,i)&&!y.contains(e,i)&&e.push(i);n--;)(i=B[n])in t&&t[i]!==o[i]&&!y.contains(e,i)&&e.push(i)};y.keys=function(t){if(!y.isObject(t))return[];if(h)return h(t);var e=[];for(var n in t)y.has(t,n)&&e.push(n);return C&&E(t,e),e},y.allKeys=function(t){if(!y.isObject(t))return[];var e=[];for(var n in t)e.push(n);return C&&E(t,e),e},y.values=function(t){for(var e=y.keys(t),n=e.length,r=Array(n),o=0;o<n;o++)r[o]=t[e[o]];return r},y.mapObject=function(t,e,n){e=w(e,n);for(var r=y.keys(t),o=r.length,i={},a=0;a<o;a++){var u=r[a];i[u]=e(t[u],u,t)}return i},y.pairs=function(t){for(var e=y.keys(t),n=e.length,r=Array(n),o=0;o<n;o++)r[o]=[e[o],t[e[o]]];return r},y.invert=function(t){for(var e={},n=y.keys(t),r=0,o=n.length;r<o;r++)e[t[n[r]]]=n[r];return e},y.functions=y.methods=function(t){var e=[];for(var n in t)y.isFunction(t[n])&&e.push(n);return e.sort()};var N=function(t,e){return function(n){var r=arguments.length;if(e&&(n=Object(n)),r<2||null==n)return n;for(var o=1;o<r;o++)for(var i=arguments[o],a=t(i),u=a.length,l=0;l<u;l++){var c=a[l];e&&void 0!==n[c]||(n[c]=i[c])}return n}};y.extend=N(y.allKeys),y.extendOwn=y.assign=N(y.keys),y.findKey=function(t,e,n){e=w(e,n);for(var r,o=y.keys(t),i=0,a=o.length;i<a;i++)if(e(t[r=o[i]],r,t))return r};var D,z,G=function(t,e,n){return e in n};y.pick=x(function(t,e){var n={},r=e[0];if(null==t)return n;y.isFunction(r)?(e.length>1&&(r=b(r,e[1])),e=y.allKeys(t)):(r=G,e=A(e,!1,!1),t=Object(t));for(var o=0,i=e.length;o<i;o++){var a=e[o],u=t[a];r(u,a,t)&&(n[a]=u)}return n}),y.omit=x(function(t,e){var n,r=e[0];return y.isFunction(r)?(r=y.negate(r),e.length>1&&(n=e[1])):(e=y.map(A(e,!1,!1),String),r=function(t,n){return!y.contains(e,n)}),y.pick(t,r,n)}),y.defaults=N(y.allKeys,!0),y.create=function(t,e){var n=k(t);return e&&y.extendOwn(n,e),n},y.clone=function(t){return y.isObject(t)?y.isArray(t)?t.slice():y.extend({},t):t},y.tap=function(t,e){return e(t),t},y.isMatch=function(t,e){var n=y.keys(e),r=n.length;if(null==t)return!r;for(var o=Object(t),i=0;i<r;i++){var a=n[i];if(e[a]!==o[a]||!(a in o))return!1}return!0},D=function(t,e,n,r){if(t===e)return 0!==t||1/t==1/e;if(null==t||null==e)return!1;if(t!=t)return e!=e;var o=typeof t;return("function"===o||"object"===o||"object"==typeof e)&&z(t,e,n,r)},z=function(t,e,n,r){t instanceof y&&(t=t._wrapped),e instanceof y&&(e=e._wrapped);var o=f.call(t);if(o!==f.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!=+t?+e!=+e:0==+t?1/+t==1/e:+t==+e;case"[object Date]":case"[object Boolean]":return+t==+e;case"[object Symbol]":return l.valueOf.call(t)===l.valueOf.call(e)}var i="[object Array]"===o;if(!i){if("object"!=typeof t||"object"!=typeof e)return!1;var a=t.constructor,u=e.constructor;if(a!==u&&!(y.isFunction(a)&&a instanceof a&&y.isFunction(u)&&u instanceof u)&&"constructor"in t&&"constructor"in e)return!1}n=n||[],r=r||[];for(var c=n.length;c--;)if(n[c]===t)return r[c]===e;if(n.push(t),r.push(e),i){if((c=t.length)!==e.length)return!1;for(;c--;)if(!D(t[c],e[c],n,r))return!1}else{var s,p=y.keys(t);if(c=p.length,y.keys(e).length!==c)return!1;for(;c--;)if(s=p[c],!y.has(e,s)||!D(t[s],e[s],n,r))return!1}return n.pop(),r.pop(),!0},y.isEqual=function(t,e){return D(t,e)},y.isEmpty=function(t){return null==t||(T(t)&&(y.isArray(t)||y.isString(t)||y.isArguments(t))?0===t.length:0===y.keys(t).length)},y.isElement=function(t){return!(!t||1!==t.nodeType)},y.isArray=d||function(t){return"[object Array]"===f.call(t)},y.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},y.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(t){y["is"+t]=function(e){return f.call(e)==="[object "+t+"]"}}),y.isArguments(arguments)||(y.isArguments=function(t){return y.has(t,"callee")});var Y=o.document&&o.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof Y&&(y.isFunction=function(t){return"function"==typeof t||!1}),y.isFinite=function(t){return!y.isSymbol(t)&&isFinite(t)&&!isNaN(parseFloat(t))},y.isNaN=function(t){return y.isNumber(t)&&isNaN(t)},y.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===f.call(t)},y.isNull=function(t){return null===t},y.isUndefined=function(t){return void 0===t},y.has=function(t,e){if(!y.isArray(e))return null!=t&&p.call(t,e);for(var n=e.length,r=0;r<n;r++){var o=e[r];if(null==t||!p.call(t,o))return!1;t=t[o]}return!!n},y.noConflict=function(){return o._=i,this},y.identity=function(t){return t},y.constant=function(t){return function(){return t}},y.noop=function(){},y.property=function(t){return y.isArray(t)?function(e){return _(e,t)}:$(t)},y.propertyOf=function(t){return null==t?function(){}:function(e){return y.isArray(e)?_(t,e):t[e]}},y.matcher=y.matches=function(t){return t=y.extendOwn({},t),function(e){return y.isMatch(e,t)}},y.times=function(t,e,n){var r=Array(Math.max(0,t));e=b(e,n,1);for(var o=0;o<t;o++)r[o]=e(o);return r},y.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},y.now=Date.now||function(){return(new Date).getTime()};var R={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},U=y.invert(R),H=function(t){var e=function(e){return t[e]},n="(?:"+y.keys(t).join("|")+")",r=RegExp(n),o=RegExp(n,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(o,e):t}};y.escape=H(R),y.unescape=H(U),y.result=function(t,e,n){y.isArray(e)||(e=[e]);var r=e.length;if(!r)return y.isFunction(n)?n.call(t):n;for(var o=0;o<r;o++){var i=null==t?void 0:t[e[o]];void 0===i&&(i=n,o=r),t=y.isFunction(i)?i.call(t):i}return t};var J=0;y.uniqueId=function(t){var e=++J+"";return t?t+e:e},y.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var K=/(.)^/,V={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},q=/\\|'|\r|\n|\u2028|\u2029/g,Z=function(t){return"\\"+V[t]};y.template=function(t,e,n){!e&&n&&(e=n),e=y.defaults({},e,y.templateSettings);var r,o=RegExp([(e.escape||K).source,(e.interpolate||K).source,(e.evaluate||K).source].join("|")+"|$","g"),i=0,a="__p+='";t.replace(o,function(e,n,r,o,u){return a+=t.slice(i,u).replace(q,Z),i=u+e.length,n?a+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?a+="'+\n((__t=("+r+"))==null?'':__t)+\n'":o&&(a+="';\n"+o+"\n__p+='"),e}),a+="';\n",e.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{r=new Function(e.variable||"obj","_",a)}catch(t){throw t.source=a,t}var u=function(t){return r.call(this,t,y)},l=e.variable||"obj";return u.source="function("+l+"){\n"+a+"}",u},y.chain=function(t){var e=y(t);return e._chain=!0,e};var W=function(t,e){return t._chain?y(e).chain():e};y.mixin=function(t){return y.each(y.functions(t),function(e){var n=y[e]=t[e];y.prototype[e]=function(){var t=[this._wrapped];return c.apply(t,arguments),W(this,n.apply(y,t))}}),y},y.mixin(y),y.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=a[t];y.prototype[t]=function(){var n=this._wrapped;return e.apply(n,arguments),"shift"!==t&&"splice"!==t||0!==n.length||delete n[0],W(this,n)}}),y.each(["concat","join","slice"],function(t){var e=a[t];y.prototype[t]=function(){return W(this,e.apply(this._wrapped,arguments))}}),y.prototype.value=function(){return this._wrapped},y.prototype.valueOf=y.prototype.toJSON=y.prototype.value,y.prototype.toString=function(){return String(this._wrapped)},void 0===(r=function(){return y}.apply(e,[]))||(n.exports=r)}()}).call(this,n(5),n(4)(t))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.popular_photos=[{desc:"Hoyts Cinema 1 ticket office, City Arcade, Perth, 25 June 1979",id:"328919PD",loc:"Plaza Arcade, 650 Hay Street, Perth",height:760,date:"2018-04-01"},{desc:"Tamil House, 189 Brisbane Street, Northbridge, May 1984",id:"312755PD",loc:null,height:502,date:"1984-05-26"},{desc:"Bassendean Hotel, Old Perth Road, Bassendean, August 1987",id:"314834PD",loc:"Old Swan Barracks Bckpkrs, 2-8 Francis Street, Perth",height:505,date:"1987-08-26"}]},function(t,e,n){"use strict";function r(t){return"http://www.oldnyc.org/#"+t}Object.defineProperty(e,"__esModule",{value:!0}),e.getCanonicalUrlForPhoto=r,e.getCommentCount=function(t){return $.get("https://graph.facebook.com/",{ids:$.map(t,function(t){return r(t)}).join(",")}).then(function(t){var e={};return $.each(t,function(t,n){e[t.replace(/.*#/,"")]=n.comments||0}),e})}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=e.MAP_STYLE=[{stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{visibility:"simplified"}]},{featureType:"poi",stylers:[{visibility:"simplified"}]},{featureType:"transit",stylers:[{visibility:"off"}]},{featureType:"landscape",stylers:[{visibility:"simplified"}]},{featureType:"road",stylers:[{visibility:"simplified"}]},{featureType:"administrative",stylers:[{visibility:"simplified"}]},{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{visibility:"on"},{color:"#e3e3e3"}]},{featureType:"landscape.natural",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{color:"#cccccc"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#FFFFFF"}]},{featureType:"road",elementType:"labels",stylers:[{color:"#94989C"},{visibility:"simplified"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}];e.STATIC_MAP_STYLE=function(t){for(var e="",n=0;n<t.length;n++){var r=t[n],o=[];if(null!=r.featureType&&o.push("feature:"+r.featureType),null!=r.elementType&&o.push("element:"+r.elementType),null!=r.stylers)for(var i=0;i<r.stylers.length;i++)for(var a in r.stylers[i])o.push(a+":"+r.stylers[i][a].replace(/#/,"0x"));e+="&style="+o.join("%7C")}return e}(r)},,function(t,e,n){"use strict";var r=n(1),o=null;function i(t,e){r.map.panTo(t),r.map.setZoom(17),o&&o.setMap(null),o=new google.maps.Marker({position:t,map:r.map,title:e})}$(function(){$("#location-search").on("keypress",function(t){if(13===t.which){var e=$(this).val();$.getJSON("https://maps.googleapis.com/maps/api/geocode/json",{address:e,key:"AIzaSyClCA1LViYi4KLQfgMlfr3PS0tyxwqzYjA",bounds:"40.490856,-74.260895|41.030091,-73.578699"}).done(function(t){i(t.results[0].geometry.location,e),ga("send","event","link","address-search")}).fail(function(t){console.error(t),ga("send","event","link","address-search-fail")})}}),$("#current-location").on("click",function(){navigator.geolocation.getCurrentPosition(function(t){var e=t.coords;i({lat:e.latitude,lng:e.longitude},"Current Location"),ga("send","event","link","current-location")},function(t){console.error(t),ga("send","event","link","current-location-error")})})})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){this.states=[],this.hashToStateAdapter=t};r.prototype.initialize=function(){var t=this;$(window).on("popstate",function(e){t.handlePopState(e.originalEvent.state)});var e={initial:!0},n=!1,r=function(){history.replaceState({},"",document.location.href),this.replaceState(e,document.title,document.location.href),n&&$(this).trigger("setStateInResponseToPageLoad",e)}.bind(this);this.hashToStateAdapter&&document.location.hash?(n=!0,this.hashToStateAdapter(document.location.hash,function(t){e=t,r()})):r()},r.prototype.makeState=function(t){var e=null;return history.state&&"id"in history.state&&(e=history.state.id),$.extend({length:history.length,previousStateId:e,id:Date.now()+""+Math.floor(1e8*Math.random())},t)},r.prototype.simplifyState=function(t){var e=$.extend({},t);return delete e.id,delete e.previousStateId,e},r.prototype.handlePopState=function(t){if(t&&"id"in t){var e=this.states[this.getStateIndexById(t.id)];if(e&&e.expectingBack)return void delete e.expectingBack}var n=function(){$(this).trigger("setStateInResponseToUser",t)}.bind(this);!t&&this.hashToStateAdapter?this.hashToStateAdapter(document.location.hash,function(e){t=e,n()}):n()},r.prototype.pushState=function(t,e,n){var r=this.makeState(t);this.states.push(r),history.pushState(r,e,n),document.title=e},r.prototype.replaceState=function(t,e,n){var r=this.getCurrentState(),o=null,i=null;r&&("id"in r&&(o=this.getStateIndexById(r.id)),"previousStateId"in r&&(i=r.previousStateId));var a=this.makeState(t);null!==i&&(a.previousStateId=i),null!==o?this.states[o]=a:this.states.push(a),history.replaceState(a,e,n),document.title=e},r.prototype.getCurrentState=function(){return history.state},r.prototype.getStateIndexById=function(t){for(var e=0;e<this.states.length;e++)if(this.states[e].id==t)return e;return null},r.prototype.getPreviousState=function(t){if(!("previousStateId"in t))return null;var e=t.previousStateId;if(null==e)return e;var n=this.getStateIndexById(e);if(null!==n)return this.states[n];throw"State out of whack!"},r.prototype.goBackUntil=function(t,e){if("string"==typeof t)return this.goBackUntil(function(e){return t in e},e);for(var n=this.getCurrentState(),r=0,o=null;n&&!t(n);)o=n,n=this.getPreviousState(n),r+=1;if(n&&r)return n.expectingBack=!0,history.go(-r),r;if(0==r)return 0;var i=r;1!=i&&(o.expectingBack=!0,history.go(-(i-1))),this.replaceState(e[0],e[1],e[2])},r.prototype.logStack=function(){for(var t=this.getCurrentState(),e=0;t;)console.log((e>0?"-":" ")+e,this.simplifyState(t)),t=this.getPreviousState(t),e++},e.default=r},function(t,e,n){"use strict";var r,o=n(12),i=(r=o)&&r.__esModule?r:{default:r},a=n(2),u=n(1);var l=new i.default(function(t,e){(0,a.hashToStateObject)(t.substr(1),e)});function c(){var t=location.pathname+location.search+location.hash;ga("send","pageview",{page:t})}$(function(){var t=function(t){return"#"+(0,a.stateObjectToHash)(t)},e=function(t){return"photo_id"in t?"Old NYC - Photo "+t.photo_id:"g"in t?"Old NYC - Grid":"Old NYC"};$(window).on("showGrid",function(n,r){var o={g:r};l.pushState(o,e(o),t(o)),c()}).on("hideGrid",function(){var n={initial:!0};l.goBackUntil("initial",[n,e(n),t(n)])}).on("openPreviewPanel",function(){var n={photo_id:!0};l.pushState(n,e(n),t(n))}).on("showPhotoPreview",function(n,r){var o={photo_id:r};"pop"==$("#expanded").data("grid-key")&&(o.g="pop"),l.replaceState(o,e(o),t(o)),c()}).on("closePreviewPanel",function(){var n={g:$("#expanded").data("grid-key")};l.goBackUntil("g",[n,e(n),t(n)])}),$(l).on("setStateInResponseToUser setStateInResponseToPageLoad",function(t,e){(0,a.transitionToStateObject)(e)}),$(l).on("setStateInResponseToPageLoad",function(){c()}),u.mapPromise.done(function(){l.initialize()})})},function(t,e,n){"use strict";var r=n(1);n(13),n(11),$(function(){(0,r.fillPopularImagesPanel)(),(0,r.initialize_map)()})}]);